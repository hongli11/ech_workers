name: Build and Release for ARMv7 (Go)

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:
    inputs:
      tag_name:
        description: 'Tag Name for Release'
        required: true
        default: 'v1.0.0'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. 检出代码
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. 设置 Go 环境 (关键步骤)
      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21' # 建议使用项目要求的Go版本，或较新的稳定版
          cache: true

      # 3. 为 Linux ARMv7 进行交叉编译 (关键步骤)
      - name: Build for Linux ARMv7
        run: |
          # 设置编译目标和输出文件名
          export GOOS=linux
          export GOARCH=arm
          export GOARM=7 # 这对应你的 armv7l
          # 编译，可自行定义输出文件名
          go build -o ech-workers-armv7 -v ./main.go # 请将 ./main.go 替换为项目实际的入口文件路径

      # 4. 验证生成的文件
      - name: Verify Binary
        run: |
          file ech-workers-armv7
          ls -lh ech-workers-armv7

      # 5. 创建 GitHub Release 并上传构建成果
      - name: Create Release and Upload
        uses: softprops/action-gh-release@v1
        with:
          files: |
            ech-workers-armv7
            README.md # 可选，可以包含其他文件
